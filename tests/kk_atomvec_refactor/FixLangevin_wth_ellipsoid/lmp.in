###
# Box and units  (use LJ units and periodic boundaries)
###

units           lj
atom_style      hybrid bond ellipsoid
dimension	    3
boundary	    p p p
newton 		    on

lattice		    diamond 0.01
region		    box block 0 10 0 10 0 10
create_box	    2 box bond/types 1 extra/bond/per/atom 2
#create_box      2 box

###################################################################
# Create Atoms in empty space
#
region         lower block 1 9 1 9 1 3
create_atoms   1 region lower
region         upper block 1 9 1 9 7 9
create_atoms   1 region upper

###################################################################
# Create Polymers
#
variable N        equal 30   # Number of beads per polymer
variable Ny_val   equal 4    # Number of polymers placed in y
variable Ny       loop ${Ny_val}
variable Nz       loop 3     # Number of polymers placed in z
variable dbead    equal 0.2  # Distance Between Beads
variable step     equal 1    # Step size for loop

# Initialise the first bead
variable x0 equal 1.0
variable y0 equal 1.0
variable z0 equal 2.0

# Create the remaining beads
label loop_z
label loop_y
label loop_bead
if "${step} > ${N}" then "jump SELF end_inner"
    variable x equal ${x0} + ${dbead}
    variable y equal ${y0} + 1.5*${Ny}
    variable z equal ${z0} + 1.5*${Nz}
    create_atoms 2 single ${x} ${y} ${z}
    variable x0 equal ${x}
    variable step equal ${step} + 1
jump SELF loop_bead
label end_inner
variable x0 equal 1.0
variable y0 equal 1.0
variable step equal 1
next Ny
jump SELF loop_y
variable x0 equal 1.0
variable y0 equal 1.0
variable z0 equal 2.0
variable step equal 1
variable Ny loop ${Ny_val}
next Nz
jump SELF loop_z

###################################################################
# Create groups, finish setup, etc
#

group           all type 1 2
group           atoms type 1
group           polys type 2

group		subA region lower
group		subB region upper
group       subAa id 1:1002
group       subAb id 101:300
group       subAc id 301:650
group       subAd id 651:900
group       subAe id 901:1235

set         group atoms mass 1.0
set         group polys mass 1.5
# velocity
set         group subAa vx 0.01 vy 0.0 vz 0.0
set         group subAb vx -0.03 vy 0.02 vz 0.0
set         group subAc vx 0.01 vy 0.01 vz 0.05
set         group subAd vx 0.0 vy 0.0 vz 0.0
set         group subAe vx 0.0 vy 0.0 vz 0.04
set         group subB vx 0.0 vy 0.0 vz -0.02
set         group polys vx 0.0 vy 0.0 vz 0.0
# shape
set         group atoms shape 1 1 1.2
set         group polys shape 1.3 1 1
# quat
set         group subAa quat 0.9237853184 0.382910976 0.0 0.0
set         group subAb quat 0.5774 0.0 0.5774 0.5774
set         group subAc quat 0.707106816 0.0 0.0 0.707106816
set         group subAd quat 0.462 0.191 0.462 0.733
set         group subAe quat 0.001 0.472 -0.157 -0.868
set         group subB quat -0.316 -0.424 0.776 0.344
# angmom
set      	group subA angmom 0.01 0.0 0.0
set      	group subB angmom 0.0 0.02 0.0
set      	group polys angmom 0.0 0.0 0.01

neighbor        1.5 bin
neigh_modify    delay 0 every 1 check yes

###################################################################
# Pair interaction between non-bonded atoms
#
pair_style      lj/cut 2.5
pair_coeff      * * 0.5 2.227246795
pair_modify     shift yes

#pair_style gayberne 0.8 1.0 1.0 4.0
#pair_coeff 1 1  0.01  1.0   0.15 0.15 1.0   0.15 0.15 1.0
#pair_coeff 1 2  0.01  1.0   0.18 0.18 1.0   0.18 0.18 1.0
#pair_coeff 2 2  0.01  1.0   0.20 0.20 1.0   0.20 0.20 1.0

###################################################################
# Pair interaction between bonded atoms
#
create_bonds many polys polys 1 0.0 2.5
bond_style harmonic
bond_coeff 1 10.0 1.85
special_bonds lj 0.0 1.0 1.0

###################################################

comm_modify cutoff 6

###
# Set up fixes
###

fix 1 all   nve/asphere   ###NVE ensemble
#fix 2 all   langevin   1.0 1.0   2.0   424242   ###Langevin integrator Tstart Tstop 1/friction rndseed

compute ekin all ke
compute epot all pe pair
compute erot all erotate/asphere
compute ebond all pe bond
variable ekin equal c_ekin
variable epot equal c_epot
variable erot equal c_erot
variable ebond equal c_ebond
variable etot equal c_ekin+c_epot+c_erot +c_ebond

fix 3 all print 1000 "$(step)  ekin = ${ekin} | epot = ${epot} | erot = ${erot} | ebond = ${ebond} | etot = ${etot}" screen yes

compute q all property/atom quatw quati quatj quatk
compute diameter all property/atom shapex shapey shapez
dump 1 all custom 1000 dump.polymer id type x y z c_q[1] c_q[2] c_q[3] c_q[4] c_diameter[1] c_diameter[2] c_diameter[3]
dump_modify 1 colname c_q[1] quatw colname c_q[2] quati colname c_q[3] quatj colname c_q[4] quatk

##### Sample thermodynamic info  (temperature, energy, pressure, etc.) #####
#thermo 1000
#thermo_style   custom   step  temp  etotal epair ebond  emol  econserve
############################################################################

timestep 0.001

run 500000

write_data data_out.* nocoeff
 
